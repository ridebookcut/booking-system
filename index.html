<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ride Bookcut - Barbershop Booking</title>
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Ride Bookcut - Barbershop Booking">
    <meta property="og:description" content="Book your barbershop appointment online with Ride Bookcut.">
    <meta property="og:image" content="https://ridebookcut.github.io/booking-system/logo.jpg.jpg">
    <meta property="og:url" content="https://ridebookcut.github.io/booking-system/">
    <meta property="og:type" content="website">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ride Bookcut - Barbershop Booking">
    <meta name="twitter:description" content="Book your barbershop appointment online with Ride Bookcut.">
    <meta name="twitter:image" content="https://ridebookcut.github.io/booking-system/logo.jpg.jpg">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #334024 0%, #2a3520 50%, #1f2718 100%);
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #334024, #2a3520);
            color: #d9c1a9;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            border: 2px solid #d9c1a9;
        }
        
        .logo {
            font-size: 4em;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .logo img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #d9c1a9;
            box-shadow: 0 4px 15px rgba(217, 193, 169, 0.4);
        }
        
        .logo-fallback {
            font-size: 4em;
            margin-bottom: 10px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: bold;
            color: #d9c1a9;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #d9c1a9, #c5ae96);
            color: #334024;
            border: 2px solid #334024;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(217, 193, 169, 0.3);
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #334024, #2a3520);
            color: #d9c1a9;
            border: 2px solid #d9c1a9;
        }
        
        .section {
            background: rgba(217, 193, 169, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 2px solid #334024;
        }
        
        .section h3 {
            margin-top: 0;
            color: #334024;
            border-bottom: 3px solid #334024;
            padding-bottom: 12px;
            font-size: 1.4em;
            font-weight: bold;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .time-slot {
            padding: 15px 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-weight: bold;
        }
        
        .time-slot.available {
            border-color: #334024;
            background-color: rgba(217, 193, 169, 0.3);
            color: #334024;
        }
        
        .time-slot.available:hover {
            background-color: #334024;
            color: #d9c1a9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(51, 64, 36, 0.4);
        }
        
        .time-slot.pending {
            border-color: #f39c12;
            background-color: #fef9e7;
            cursor: not-allowed;
        }
        
        .time-slot.confirmed {
            border-color: #27ae60;
            background-color: #e8f8f1;
            cursor: not-allowed;
        }
        
        .time-slot.selected {
            background-color: #334024;
            color: #d9c1a9;
            border-color: #334024;
            box-shadow: 0 4px 15px rgba(51, 64, 36, 0.4);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #334024;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #334024, #2a3520);
            color: #d9c1a9;
            border: 2px solid #d9c1a9;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(51, 64, 36, 0.3);
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #d9c1a9, #c5ae96);
            color: #334024;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(217, 193, 169, 0.4);
        }
        
        .btn.confirm {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #27ae60;
            color: white;
        }
        
        .btn.decline {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            color: white;
        }
        
        .booking-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            animation: fadeIn 0.5s ease-in;
        }
        
        .notification.success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .notification.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .notification.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        
        .date-group {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .date-group h4 {
            background-color: #334024;
            color: #d9c1a9;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        
        .date-group h4::after {
            content: "▼";
            float: right;
            transition: transform 0.3s ease;
        }
        
        .date-group h4.collapsed::after {
            transform: rotate(-90deg);
        }
        
        .date-group.collapsed .bookings-content {
            display: none;
        }
        
        .bookings-content {
            margin-left: 10px;
        }
        
        /* Calendar view styles */
        .calendar-container {
            margin: 20px 0;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            background: #334024;
            color: #d9c1a9;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
        }
        
        .calendar-nav:hover {
            background: #2a3520;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .calendar-day {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-day:hover {
            background: #e9ecef;
        }
        
        .calendar-day.has-bookings {
            background: #d1ecf1;
            border-color: #bee5eb;
            font-weight: bold;
        }
        
        .calendar-day.has-bookings:hover {
            background: #c1e0e7;
        }
        
        .calendar-day.selected {
            background: #334024;
            color: #d9c1a9;
            border-color: #334024;
        }
        
        .calendar-day.empty {
            background: #f8f9fa;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            background: #f8f9fa;
        }
        
        .calendar-view-toggle {
            background: #334024;
            color: #d9c1a9;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .calendar-view-toggle:hover {
            background: #2a3520;
        }
        
        .selected-date-bookings {
            margin-top: 20px;
        }
        
        .selected-date-header {
            background: #334024;
            color: #d9c1a9;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <img id="logoImage" src="https://ridebookcut.github.io/booking-system/logo.jpg.jpg" onerror="this.src='logo.jpg.jpg'; this.onerror=null;" alt="Ride Bookcut Logo">
            <div class="logo-fallback" id="logoFallback" style="display: none;">✂️</div>
        </div>
        <h1>Ride Bookcut</h1>
        <p>Book or Cook</p>
    </div>

    <div class="mode-selector">
        <button class="mode-btn active" id="customerBtn" onclick="showCustomerView()">Customer View</button>
        <button class="mode-btn" id="adminBtn" onclick="showAdminView()">Owner Panel</button>
    </div>

    <!-- Customer View -->
    <div id="customerView">
        <div class="section">
            <h3>Book Your Appointment</h3>
            <div id="customerNotification"></div>
            <div class="form-group">
                <label for="selectedDate">Select Date:</label>
                <input type="date" id="selectedDate" onchange="loadTimeSlots()">
            </div>
            
            <div id="timeSlots" class="time-slots"></div>
            
            <div id="bookingForm" class="hidden">
                <h3>Booking Details</h3>
                <div class="form-group">
                    <label for="customerName">Your Name:</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label for="customerPhone">Phone Number:</label>
                    <input type="tel" id="customerPhone" required>
                </div>
                <div class="form-group">
                    <label for="serviceRequest">Service Requested:</label>
                    <input type="text" id="serviceRequest" placeholder="e.g., Haircut, Beard trim" required>
                </div>
                <button class="btn" onclick="submitBooking()">Submit Booking Request</button>
                <button class="btn" onclick="cancelCustomerBooking()" style="margin-left: 10px; background: #ccc; color: #333;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Admin View -->
    <div id="adminView" class="hidden">
        <div class="section" id="adminLogin">
            <h3>Owner Login</h3>
            <div id="adminNotification"></div>
            <div class="form-group">
                <label for="adminPassword">Password:</label>
                <input type="password" id="adminPassword" placeholder="Enter admin password">
            </div>
            <button class="btn" onclick="adminLogin()">Login</button>
        </div>
        
        <div id="adminPanel" class="hidden">
            <div class="section">
                <h3>Cross-Device Sync Status</h3>
                <div id="sheetsNotification"></div>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                    <h4 style="margin: 0 0 10px 0; color: #856404;">🚀 Firebase Cross-Device Sync Ready</h4>
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <strong>Current Status:</strong> <span id="firebaseStatus">Connecting...</span><br>
                        <strong>For Real Cross-Device Sync:</strong> Configure Firebase in the &lt;head&gt; section
                    </p>
                </div>
                <button class="btn" onclick="testConnection()" style="background: #2ecc71;">Test Sync</button>
                <button class="btn" onclick="manualSync()" style="background: #3498db; margin-left: 10px;">Force Sync</button>
                <button class="btn" onclick="clearLocalData()" style="background: #e74c3c; margin-left: 10px;">Clear Data</button>
                <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    <strong>Status:</strong> <span id="dbStatus" style="color: #27ae60;">Ready</span><br>
                    <strong>Last Sync:</strong> <span id="lastSyncTime">Never</span><br>
                    <strong>Stored Dates:</strong> <span id="storedDates">0</span>
                </div>
            </div>
            
            <div class="section">
                <h3>Day Off Management</h3>
                <div id="dayOffNotification"></div>
                <div class="form-group">
                    <label for="dayOffDate">Mark Day Off:</label>
                    <input type="date" id="dayOffDate">
                </div>
                <button class="btn" onclick="toggleDayOff()">Toggle Day Off</button>
                <div id="dayOffList" style="margin-top: 15px;"></div>
            </div>
            
            <div class="section">
                <h3>Pending Bookings</h3>
                <div id="adminPanelNotification"></div>
                <div id="pendingBookings"></div>
            </div>
            
            <div class="section">
                <h3>All Bookings</h3>
                <div id="allBookings"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration - REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDfJHA-L2EFRQMQnY7QnhxoSIuKYOWsKkE",
            authDomain: "ridebookcut-a7df4.firebaseapp.com",
            projectId: "ridebookcut-a7df4",
            storageBucket: "ridebookcut-a7df4.firebasestorage.app",
            messagingSenderId: "1037928263057",
            appId: "1:1037928263057:web:517c34a6c3aaf86a8c7e30"
        };

        // Initialize Firebase
        let db;
        let firebaseInitialized = false;
        
        try {
            firebase.initializeApp(firebaseConfig);	
            db = firebase.firestore();
            firebaseInitialized = true;
            document.getElementById('firebaseStatus').textContent = 'Connected';
            document.getElementById('firebaseStatus').style.color = '#27ae60';
        } catch (error) {
            console.error("Firebase initialization error:", error);
            document.getElementById('firebaseStatus').textContent = 'Error - Check config';
            document.getElementById('firebaseStatus').style.color = '#e74c3c';
        }

        // Simple booking system with Firebase
        const STORAGE_KEY = 'rideBookcutBookings';
        
        let bookingsData = {};
        let daysOffData = [];
        let selectedDate = '';
        let selectedTime = '';
        let isAdminLoggedIn = false;
        
        // Notification system
        function showNotification(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `<div class="notification ${type}">${message}</div>`;
                setTimeout(() => container.innerHTML = '', 5000);
            }
        }
        
        // Initialize
        window.onload = async function() {
            // Auto-select next day after 7 PM
            const now = new Date();
            let selectedDateObj = now;
            let dateAutoAdvanced = false;
            if (now.getHours() >= 19) { // 7 PM
                selectedDateObj = new Date(now);
                selectedDateObj.setDate(now.getDate() + 1);
                dateAutoAdvanced = true;
            }
            
            const selectedDateStr = selectedDateObj.toISOString().split('T')[0];
            document.getElementById('selectedDate').value = selectedDateStr;
            document.getElementById('selectedDate').min = new Date().toISOString().split('T')[0];
            selectedDate = selectedDateStr;
            
            // Show notification if date was auto-advanced
            if (dateAutoAdvanced) {
                showNotification('customerNotification', '📅 Date automatically set to next day after 7 PM', 'info');
            }
            
            // Try to load your original logo
            await loadLogo();
            
            // Load data from Firebase or localStorage
            await loadFromStorage();
            loadTimeSlots();
            updateDisplay();
        };
        
        // Smart logo loading - finds your original logo when hosted online
        async function loadLogo() {
            const logoImage = document.getElementById('logoImage');
            const logoFallback = document.getElementById('logoFallback');
            // Try common names for your logo file
            const possibleNames = [
                'logo.jpg.jpg', 
                'logo.jpg', 
                'logo.jpeg', 
                'logo.png', 
                'ride-bookcut-logo.jpg', 
                'ride-bookcut-logo.png',
                'https://ridebookcut.github.io/booking-system/logo.jpg.jpg'
            ];
            
            for (const filename of possibleNames) {
                try {
                    await new Promise((resolve, reject) => {
                        const testImg = new Image();
                        testImg.onload = () => {
                            console.log('✅ Your original logo loaded:', filename);
                            logoImage.src = filename;
                            logoImage.style.display = 'block';
                            logoFallback.style.display = 'none';
                            resolve();
                        };
                        testImg.onerror = reject;
                        testImg.src = filename;
                    });
                    return; // Success - exit the loop
                } catch (error) {
                    // Continue trying next filename
                }
            }
            
            // If no logo found (local file restrictions), show fallback
            console.log('📋 Logo will display when hosted online');
            logoFallback.style.display = 'block';
        }
        
        // Load from Firebase or localStorage
        async function loadFromStorage() {
            if (firebaseInitialized) {
                try {
                    // Load bookings from Firebase
                    const bookingsSnapshot = await db.collection('bookings').get();
                    bookingsData = {};
                    bookingsSnapshot.forEach(doc => {
                        const data = doc.data();
                        if (!bookingsData[data.date]) {
                            bookingsData[data.date] = {};
                        }
                        bookingsData[data.date][data.time] = data;
                    });
                    
                    // Load days off from Firebase
                    const daysOffSnapshot = await db.collection('daysOff').get();
                    daysOffData = [];
                    daysOffSnapshot.forEach(doc => {
                        daysOffData.push(doc.id);
                    });
                    
                    console.log('✅ Data loaded from Firebase');
                } catch (error) {
                    console.error('❌ Firebase load error, falling back to localStorage:', error);
                    loadFromLocalStorage();
                }
            } else {
                loadFromLocalStorage();
            }
        }
        
        // Fallback to localStorage
        function loadFromLocalStorage() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                bookingsData = JSON.parse(stored);
            }
            
            const storedDaysOff = localStorage.getItem(STORAGE_KEY + '_daysoff');
            if (storedDaysOff) {
                daysOffData = JSON.parse(storedDaysOff);
            }
        }
        
        // Save to Firebase or localStorage
        async function saveToStorage() {
            if (firebaseInitialized) {
                try {
                    // Save bookings to Firebase
                    const batch = db.batch();
                    
                    // Clear existing bookings
                    const existingBookings = await db.collection('bookings').get();
                    existingBookings.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    // Add current bookings
                    Object.keys(bookingsData).forEach(date => {
                        Object.keys(bookingsData[date]).forEach(time => {
                            const booking = bookingsData[date][time];
                            const docRef = db.collection('bookings').doc(`${date}_${time}`);
                            batch.set(docRef, booking);
                        });
                    });
                    
                    // Clear existing days off
                    const existingDaysOff = await db.collection('daysOff').get();
                    existingDaysOff.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    // Add current days off
                    daysOffData.forEach(date => {
                        const docRef = db.collection('daysOff').doc(date);
                        batch.set(docRef, { date: date });
                    });
                    
                    await batch.commit();
                    console.log('✅ Data saved to Firebase');
                } catch (error) {
                    console.error('❌ Firebase save error:', error);
                    saveToLocalStorage(); // Fallback to localStorage
                }
            } else {
                saveToLocalStorage();
            }
            
            updateDisplay();
        }
        
        // Fallback to localStorage
        function saveToLocalStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(bookingsData));
            localStorage.setItem(STORAGE_KEY + '_daysoff', JSON.stringify(daysOffData));
        }
        
        // Update display counters
        function updateDisplay() {
            const storedDatesElement = document.getElementById('storedDates');
            const statusElement = document.getElementById('dbStatus');
            const timeElement = document.getElementById('lastSyncTime');
            
            if (storedDatesElement) {
                storedDatesElement.textContent = Object.keys(bookingsData).length;
            }
            
            if (statusElement) {
                statusElement.textContent = firebaseInitialized ? 'Firebase Connected' : 'Using localStorage';
                statusElement.style.color = firebaseInitialized ? '#27ae60' : '#f39c12';
            }
            
            if (timeElement) {
                timeElement.textContent = new Date().toLocaleTimeString();
            }
        }
        
        // Generate time slots
        function generateTimeSlots() {
            const slots = [];
            for (let hour = 9; hour < 19; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    slots.push(`${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`);
                }
            }
            return slots;
        }
        
        // Load and display time slots
        function loadTimeSlots() {
            selectedDate = document.getElementById('selectedDate').value;
            if (!selectedDate) return;
            
            const container = document.getElementById('timeSlots');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Check if this date is marked as day off
            if (daysOffData.includes(selectedDate)) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c; font-weight: bold; font-size: 1.2em;">🚫 DAY OFF - No bookings available</div>';
                return;
            }
            
            const dateBookings = bookingsData[selectedDate] || {};
            
            generateTimeSlots().forEach(time => {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.textContent = time;
                
                const booking = dateBookings[time];
                if (booking) {
                    if (booking.status === 'pending') {
                        slot.className += ' pending';
                        slot.innerHTML = `${time}<br><small>Pending</small>`;
                    } else if (booking.status === 'confirmed') {
                        slot.className += ' confirmed';
                        slot.innerHTML = `${time}<br><strong>BOOKED</strong><br><small>${booking.customerName}</small>`;
                    }
                } else {
                    // Disable past time slots for today
                    const now = new Date();
                    const today = now.toISOString().split('T')[0];
                    const selectedDateObj = new Date(selectedDate);
                    
                    if (selectedDate === today) {
                        const [hours, minutes] = time.split(':').map(Number);
                        const slotTime = new Date(selectedDateObj);
                        slotTime.setHours(hours, minutes, 0, 0);
                        
                        if (slotTime < now) {
                            slot.className += ' confirmed'; // Reusing confirmed style for past slots
                            slot.innerHTML = `${time}<br><small>Past</small>`;
                            slot.style.cursor = 'not-allowed';
                            return; // Skip onclick for past slots
                        }
                    }
                    
                    slot.className += ' available';
                    slot.onclick = () => selectTimeSlot(time, slot);
                }
                
                container.appendChild(slot);
            });
        }
        
        // Select time slot
        function selectTimeSlot(time, element) {
            document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
            element.classList.add('selected');
            selectedTime = time;
            document.getElementById('bookingForm').classList.remove('hidden');
        }
        
        // Submit booking
        function submitBooking() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const service = document.getElementById('serviceRequest').value.trim();
            
            if (!name || !phone || !service || !selectedTime) {
                showNotification('customerNotification', '⚠️ Please fill in all fields and select a time slot.', 'error');
                return;
            }
            
            // Check if the selected date is a day off
            if (daysOffData.includes(selectedDate)) {
                showNotification('customerNotification', '🚫 Sorry, this date is marked as day off. Please select another date.', 'error');
                return;
            }
            
            const booking = {
                id: 'BK' + Date.now(),
                date: selectedDate,
                time: selectedTime,
                customerName: name,
                customerPhone: phone,
                serviceRequest: service,
                status: 'pending',
                timestamp: new Date().toISOString()
            };
            
            if (!bookingsData[selectedDate]) bookingsData[selectedDate] = {};
            bookingsData[selectedDate][selectedTime] = booking;
            
            saveToStorage();
            
            // Clear form
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('serviceRequest').value = '';
            document.getElementById('bookingForm').classList.add('hidden');
            
            // Refresh display to show the pending booking
            loadTimeSlots();
            
            showNotification('customerNotification', '✅ Booking submitted! Status: PENDING - waiting for owner confirmation.', 'success');
        }
        
        // Cancel booking (customer)
        function cancelCustomerBooking() {
            document.getElementById('bookingForm').classList.add('hidden');
            document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
            selectedTime = '';
        }
        
        // Show customer view
        function showCustomerView() {
            document.getElementById('customerView').classList.remove('hidden');
            document.getElementById('adminView').classList.add('hidden');
            document.getElementById('customerBtn').classList.add('active');
            document.getElementById('adminBtn').classList.remove('active');
            loadTimeSlots();
        }
        
        // Show admin view
        function showAdminView() {
            document.getElementById('customerView').classList.add('hidden');
            document.getElementById('adminView').classList.remove('hidden');
            document.getElementById('customerBtn').classList.remove('active');
            document.getElementById('adminBtn').classList.add('active');
            
            if (isAdminLoggedIn) {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadAdminBookings();
                loadDayOffList();
            } else {
                document.getElementById('adminLogin').classList.remove('hidden');
                document.getElementById('adminPanel').classList.add('hidden');
            }
        }
        
        // Admin login
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === 'ridebookcut123') {
                isAdminLoggedIn = true;
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('adminPassword').value = '';
                
                loadAdminBookings();
                loadDayOffList();
                updateDisplay();
                showNotification('adminPanelNotification', '✅ Login successful!', 'success');
            } else {
                showNotification('adminNotification', '❌ Incorrect password.', 'error');
                document.getElementById('adminPassword').value = '';
            }
        }
        
        // Load admin bookings
        function loadAdminBookings() {
            const allBookings = [];
            
            Object.keys(bookingsData).forEach(date => {
                if (bookingsData[date]) {
                    Object.keys(bookingsData[date]).forEach(time => {
                        if (bookingsData[date][time]) {
                            allBookings.push(bookingsData[date][time]);
                        }
                    });
                }
            });
            
            const pendingBookings = allBookings.filter(b => b.status === 'pending');
            // Sort pending bookings by date and time
            pendingBookings.sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));
            
            // Pending bookings
            const pendingContainer = document.getElementById('pendingBookings');
            if (pendingContainer) {
                if (pendingBookings.length === 0) {
                    pendingContainer.innerHTML = '<p>No pending bookings.</p>';
                } else {
                    // Group pending bookings by date
                    const pendingByDate = {};
                    pendingBookings.forEach(booking => {
                        if (!pendingByDate[booking.date]) {
                            pendingByDate[booking.date] = [];
                        }
                        pendingByDate[booking.date].push(booking);
                    });
                    
                    // Generate HTML for pending bookings grouped by date
                    let pendingHTML = '';
                    Object.keys(pendingByDate).forEach(date => {
                        const dateObj = new Date(date + 'T00:00:00');
                        const formattedDate = dateObj.toLocaleDateString('en-US', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        
                        pendingHTML += `
                            <div class="date-group" id="pending-date-${date}">
                                <h4 onclick="toggleDateGroup('pending-date-${date}')">${formattedDate}</h4>
                                <div class="bookings-content">
                        `;
                        
                        pendingByDate[date].forEach(booking => {
                            pendingHTML += `
                                <div class="booking-item">
                                    <div>
                                        <strong>${booking.customerName}</strong><br>
                                        🕐 ${booking.time}<br>
                                        📞 ${booking.customerPhone}<br>
                                        ✂️ ${booking.serviceRequest}
                                    </div>
                                    <div style="margin-top: 15px;">
                                        <button class="btn confirm" onclick="confirmBooking('${booking.id}')">✅ Confirm</button>
                                        <button class="btn decline" onclick="declineBooking('${booking.id}')" style="margin-left: 10px;">❌ Decline</button>
                                    </div>
                                </div>
                            `;
                        });
                        
                        pendingHTML += `
                                </div>
                            </div>
                        `;
                    });
                    
                    pendingContainer.innerHTML = pendingHTML;
                }
            }
            
            // All bookings - sort by date (newest first) then by time
            allBookings.sort((a, b) => {
                // First sort by date (newest first)
                const dateComparison = new Date(b.date) - new Date(a.date);
                if (dateComparison !== 0) {
                    return dateComparison;
                }
                // Then sort by time
                return new Date('1970/01/01 ' + a.time) - new Date('1970/01/01 ' + b.time);
            });
            
            // All bookings
            const allContainer = document.getElementById('allBookings');
            if (allContainer) {
                if (allBookings.length === 0) {
                    allContainer.innerHTML = '<p>No bookings yet.</p>';
                } else {
                    // Group all bookings by date
                    const allByDate = {};
                    allBookings.forEach(booking => {
                        if (!allByDate[booking.date]) {
                            allByDate[booking.date] = [];
                        }
                        allByDate[booking.date].push(booking);
                    });
                    
                    // Generate HTML for all bookings grouped by date (newest first)
                    let allHTML = '';
                    Object.keys(allByDate).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
                        const dateObj = new Date(date + 'T00:00:00');
                        const formattedDate = dateObj.toLocaleDateString('en-US', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        
                        allHTML += `
                            <div class="date-group" id="all-date-${date}">
                                <h4 onclick="toggleDateGroup('all-date-${date}')">${formattedDate}</h4>
                                <div class="bookings-content">
                        `;
                        
                        allByDate[date].forEach(booking => {
                            allHTML += `
                                <div class="booking-item">
                                    <div>
                                        <strong>${booking.customerName}</strong><br>
                                        🕐 ${booking.time}<br>
                                        📞 ${booking.customerPhone}<br>
                                        ✂️ ${booking.serviceRequest}<br>
                                        <strong>Status: ${booking.status.toUpperCase()}</strong>
                                    </div>
                                    <div style="margin-top: 10px;">
                                        ${booking.status === 'confirmed' ? 
                                            `<button class="btn decline" onclick="cancelConfirmedBooking('${booking.id}')" style="background: #e74c3c;">❌ Cancel Booking</button>` : 
                                            ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        allHTML += `
                                </div>
                            </div>
                        `;
                    });
                    
                    allContainer.innerHTML = allHTML;
                }
            }
        }
        
        // Toggle date group visibility
        function toggleDateGroup(groupId) {
            const group = document.getElementById(groupId);
            const header = group.querySelector('h4');
            header.classList.toggle('collapsed');
            group.classList.toggle('collapsed');
        }
        
        // Confirm booking
        function confirmBooking(bookingId) {
            updateBookingStatus(bookingId, 'confirmed');
        }
        
        // Decline booking
        function declineBooking(bookingId) {
            updateBookingStatus(bookingId, 'declined');
        }
        
        // Cancel confirmed booking (admin)
        function cancelConfirmedBooking(bookingId) {
            if (confirm('⚠️ Are you sure you want to cancel this confirmed booking? This cannot be undone!')) {
                updateBookingStatus(bookingId, 'cancelled');
            }
        }
        
        // Update booking status
        function updateBookingStatus(bookingId, newStatus) {
            Object.keys(bookingsData).forEach(date => {
                if (bookingsData[date]) {
                    Object.keys(bookingsData[date]).forEach(time => {
                        if (bookingsData[date][time] && bookingsData[date][time].id === bookingId) {
                            if (newStatus === 'declined' || newStatus === 'cancelled') {
                                delete bookingsData[date][time];
                            } else {
                                bookingsData[date][time].status = newStatus;
                            }
                            
                            saveToStorage();
                            loadAdminBookings();
                            loadTimeSlots(); // Refresh customer view too
                            
                            showNotification('adminPanelNotification', 
                                `✅ Booking ${newStatus === 'confirmed' ? 'confirmed' : newStatus === 'cancelled' ? 'cancelled' : 'declined'}!`, 
                                'success');
                            return;
                        }
                    });
                }
            });
        }
        
        // Toggle day off
        function toggleDayOff() {
            const dateInput = document.getElementById('dayOffDate');
            const selectedDayOff = dateInput.value;
            
            if (!selectedDayOff) {
                showNotification('dayOffNotification', '⚠️ Please select a date first.', 'error');
                return;
            }
            
            const dateIndex = daysOffData.indexOf(selectedDayOff);
            
            if (dateIndex === -1) {
                // Add day off
                daysOffData.push(selectedDayOff);
                
                // Remove any existing bookings for this date
                if (bookingsData[selectedDayOff]) {
                    delete bookingsData[selectedDayOff];
                }
                
                saveToStorage();
                showNotification('dayOffNotification', '🚫 Day marked as OFF! No bookings will be accepted.', 'success');
            } else {
                // Remove day off
                daysOffData.splice(dateIndex, 1);
                saveToStorage();
                showNotification('dayOffNotification', '✅ Day off removed! Bookings are now available.', 'success');
            }
            
            dateInput.value = '';
            loadDayOffList();
            loadTimeSlots(); // Refresh customer view
        }
        
        // Load and display days off list
        function loadDayOffList() {
            const container = document.getElementById('dayOffList');
            if (!container) return;
            
            if (daysOffData.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic;">No days off scheduled.</p>';
                return;
            }
            
            // Sort dates
            const sortedDates = [...daysOffData].sort();
            
            container.innerHTML = '<h4>Scheduled Days Off:</h4>' + 
                sortedDates.map(date => {
                    const dateObj = new Date(date + 'T00:00:00');
                    const formattedDate = dateObj.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #e74c3c;">
                            <span>🚫 ${formattedDate}</span>
                            <button class="btn" style="padding: 5px 10px; font-size: 12px; background: #dc3545;" onclick="removeDayOff('${date}')">Remove</button>
                        </div>
                    `;
                }).join('');
        }
        
        // Remove specific day off
        function removeDayOff(date) {
            const index = daysOffData.indexOf(date);
            if (index > -1) {
                daysOffData.splice(index, 1);
                saveToStorage();
                showNotification('dayOffNotification', '✅ Day off removed!', 'success');
                loadDayOffList();
                loadTimeSlots();
            }
        }
        
        // Admin panel functions
        function testConnection() {
            if (firebaseInitialized) {
                showNotification('sheetsNotification', '✅ Firebase connection successful! Real-time sync enabled.', 'success');
            } else {
                showNotification('sheetsNotification', '⚠️ Firebase not configured. Using localStorage instead.', 'info');
            }
        }
        
        function manualSync() {
            loadFromStorage();
            loadTimeSlots();
            if (isAdminLoggedIn) {
                loadAdminBookings();
                loadDayOffList();
            }
            updateDisplay();
            showNotification('sheetsNotification', '✅ Manual sync completed!', 'success');
        }
        
        function clearLocalData() {
            if (confirm('⚠️ Are you sure you want to clear ALL booking data? This cannot be undone!')) {
                bookingsData = {};
                daysOffData = [];
                
                if (firebaseInitialized) {
                    // Clear Firebase data
                    db.collection('bookings').get().then(snapshot => {
                        const batch = db.batch();
                        snapshot.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        return batch.commit();
                    }).then(() => {
                        return db.collection('daysOff').get();
                    }).then(snapshot => {
                        const batch = db.batch();
                        snapshot.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        return batch.commit();
                    }).then(() => {
                        showNotification('sheetsNotification', '✅ All Firebase data cleared successfully!', 'success');
                    }).catch(error => {
                        console.error('Error clearing Firebase data:', error);
                        showNotification('sheetsNotification', '❌ Error clearing Firebase data.', 'error');
                    });
                } else {
                    // Clear localStorage data
                    localStorage.removeItem(STORAGE_KEY);
                    localStorage.removeItem(STORAGE_KEY + '_daysoff');
                    showNotification('sheetsNotification', '✅ Local data cleared successfully!', 'success');
                }
                
                loadTimeSlots();
                if (isAdminLoggedIn) {
                    loadAdminBookings();
                    loadDayOffList();
                }
                updateDisplay();
            }
        }
    </script>
</body>
</html>